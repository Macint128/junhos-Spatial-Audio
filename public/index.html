<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <link rel="manifest" href="manifest.json">
  <title>AR 공간음향 게임</title>
  <style>
    body { margin:0; overflow:hidden; }
    #enter-ar {
      position: absolute;
      bottom: 20px; left: 50%;
      transform: translateX(-50%);
      padding: 12px 24px;
      font-size: 18px;
      background: #4a90e2;
      color: white;
      border: none;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <button id="enter-ar">AR 시작</button>
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/webxr/ARButton.js"></script>
  <script>
    let camera, scene, renderer;
    let spheres = [];
    let audioCtx, source, panner, correctSphere;

    init();

    function init(){
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera();

      renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.xr.enabled = true;
      document.body.appendChild(renderer.domElement);

      // 광원
      const light = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 1);
      scene.add(light);

      // 오브젝트 생성 (세 개의 구체)
      const geometry = new THREE.SphereGeometry(0.1, 32, 32);
      const material = new THREE.MeshStandardMaterial({ color: 0x00ffcc });

      for(let i=0;i<3;i++){
        const sphere = new THREE.Mesh(geometry, material.clone());
        sphere.position.set((i-1)*0.5, 0, -1.5); // -0.5, 0, +0.5
        scene.add(sphere);
        spheres.push(sphere);
      }

      document.getElementById("enter-ar").onclick = () => {
        document.body.appendChild(ARButton.createButton(renderer));
        startRound();
        renderer.setAnimationLoop(render);
      };
    }

    function render(){
      spheres.forEach(s=>s.rotation.y += 0.01);
      renderer.render(scene, camera);
    }

    // 오디오
    function playFromSphere(sphere){
      if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
      if(source) source.stop();

      source = audioCtx.createOscillator();
      source.type = "sine";
      source.frequency.value = 440;

      panner = audioCtx.createPanner();
      panner.panningModel = "HRTF";
      panner.distanceModel = "inverse";

      let pos = sphere.position;
      panner.setPosition(pos.x, pos.y, pos.z);

      source.connect(panner).connect(audioCtx.destination);
      source.start();
      source.stop(audioCtx.currentTime + 2);
    }

    function startRound(){
      correctSphere = spheres[Math.floor(Math.random()*spheres.length)];
      playFromSphere(correctSphere);
    }
  </script>
</body>
</html>
